<!DOCTYPE html>
<html lang="kk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–µ–ª–≥—ñ “ö“±—Ä–∞—Å—Ç—ã—Ä - JolEreje</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .game-wrapper {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            user-select: none;
        }

        /* WORKSHOP LAYOUT */
        .workshop-container {
            display: grid;
            grid-template-columns: 250px 1fr 250px;
            gap: 20px;
            background: #f4f4f4;
            border-radius: 20px;
            padding: 20px;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.05);
            min-height: 500px;
        }

        @media (max-width: 900px) {
            .workshop-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }

            .panel {
                max-height: 200px;
                /* Scrollable on mobile */
                overflow-x: auto;
                display: flex;
                /* Horizontal row */
                gap: 10px;
                flex-wrap: nowrap;
            }

            .panel-grid {
                display: flex !important;
                gap: 15px;
            }

            .assembly-area {
                min-height: 300px;
            }
        }

        /* PANELS */
        .panel {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .panel-title {
            font-weight: bold;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .panel-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            overflow-y: auto;
        }

        /* DRAGGABLE ITEMS */
        .part-item {
            width: 80px;
            height: 80px;
            cursor: grab;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid transparent;
            border-radius: 10px;
        }

        .part-item:hover {
            transform: scale(1.1);
            background: #f0f0f0;
        }

        .part-item:active {
            cursor: grabbing;
        }

        /* SVG STYLES within parts */
        .part-item svg,
        .part-item i {
            pointer-events: none;
            /* Let drag event happen on parent */
        }

        /* ASSEMBLY AREA (CENTER) */
        .assembly-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            position: relative;
            background: radial-gradient(circle, #fff 0%, #e0e0e0 100%);
            border-radius: 15px;
            padding: 20px;
            border: 4px dashed #ccc;
        }

        .drop-zone {
            width: 250px;
            height: 250px;
            margin-top: 50px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .drop-zone.hovever {
            transform: scale(1.05);
            filter: drop-shadow(0 0 10px rgba(50, 200, 50, 0.5));
        }

        /* Constructed Sign Layers */
        .sign-base {
            position: absolute;
            z-index: 10;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.2));
        }

        .sign-icon {
            position: absolute;
            z-index: 20;
            font-size: 4rem;
            color: #333;
        }

        /* TASK BAR */
        .task-header {
            text-align: center;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        /* BUTTONS */
        .btn-action {
            padding: 12px 30px;
            border-radius: 30px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .btn-check {
            background: var(--primary);
            color: white;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-check:hover {
            transform: translateY(-2px);
        }

        .btn-clear {
            background: #eee;
            color: #555;
        }

        /* FEEDBACK */
        .feedback-bubble {
            background: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-top: 10px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .feedback-bubble.show {
            opacity: 1;
        }
    </style>
</head>

<body>
    <div class="bg-decoration">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <nav class="navbar">
        <div class="logo" onclick="window.location.href='index.html'">
            <span class="logo-icon">üö¶</span>
            <span class="logo-text">JolEreje</span>
        </div>
        <a href="game.html" class="back-link" style="margin:0; font-size:0.9rem;">
            <i class="fa-solid fa-arrow-left"></i> –ê—Ä—Ç“õ–∞
        </a>
    </nav>

    <div class="game-wrapper">

        <div class="task-header">
            <span style="color:#888; font-size:0.9rem; text-transform:uppercase;">–¢–∞–ø—Å—ã—Ä–º–∞ <span
                    id="lvl-count">1/5</span></span>
            <h2 id="lvl-name" style="margin: 5px 0;">"–¢–û“ö–¢–ê" –±–µ–ª–≥—ñ—Å—ñ–Ω “õ“±—Ä–∞—Å—Ç—ã—Ä</h2>
            <p id="lvl-hint" style="color:#666; font-size:0.95rem;">“ö—ã–∑—ã–ª —Å–µ–≥—ñ–∑–±“±—Ä—ã—à + STOP –∂–∞–∑—É—ã</p>
        </div>

        <div class="workshop-container">

            <!-- SHAPES PANEL -->
            <div class="panel">
                <div class="panel-title"><i class="fa-solid fa-shapes"></i> –ü—ñ—à—ñ–Ω–¥–µ—Ä</div>
                <div class="panel-grid" id="shapes-list">
                    <!-- SVG Shapes populated by JS -->
                </div>
            </div>

            <!-- ASSEMBLY AREA -->
            <div class="assembly-area" ondragover="allowDrop(event)" ondrop="handleDrop(event)"
                ondragenter="handleEnter(event)" ondragleave="handleLeave(event)">

                <div class="pole"
                    style="position:absolute; bottom:0; width:10px; height:150px; background:#555; border-radius:5px 5px 0 0;">
                </div>

                <div class="drop-zone" id="drop-zone">
                    <span style="color:#aaa; pointer-events:none;">–ë”©–ª—à–µ–∫—Ç–µ—Ä–¥—ñ –æ—Å—ã–Ω–¥–∞ —Ç–∞—Å—Ç–∞“£—ã–∑</span>
                </div>

                <div class="feedback-bubble" id="feedback">“ö–∞—Ç–µ! –î“±—Ä—ã—Å –µ–º–µ—Å.</div>

                <div style="display:flex; gap:10px; width:100%; justify-content:center;">
                    <button class="btn-action btn-clear" onclick="clearSign()">–¢–∞–∑–∞–ª–∞—É</button>
                    <button class="btn-action btn-check" onclick="checkSign()">–¢–µ–∫—Å–µ—Ä—É</button>
                </div>
            </div>

            <!-- ICONS PANEL -->
            <div class="panel">
                <div class="panel-title"><i class="fa-solid fa-icons"></i> –ë–µ–ª–≥—ñ–ª–µ—Ä</div>
                <div class="panel-grid" id="icons-list">
                    <!-- Icons populated by JS -->
                </div>
            </div>

        </div>

    </div>

    <!-- Success Modal -->
    <div id="win-modal"
        style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index:100;">
        <div style="background:white; padding:40px; border-radius:20px; text-align:center; animation: popIn 0.4s;">
            <div style="font-size:5rem; margin-bottom:20px;">üéâ</div>
            <h2>–ñ–∞—Ä–∞–π—Å—ã“£!</h2>
            <p>–ë–µ–ª–≥—ñ –¥“±—Ä—ã—Å “õ“±—Ä–∞—Å—Ç—ã—Ä—ã–ª–¥—ã.</p>
            <button class="btn-action btn-check" onclick="nextLevel()" style="margin-top:20px;">–ö–µ–ª–µ—Å—ñ –¥–µ“£–≥–µ–π</button>
        </div>
    </div>

    <script>
        /* ASSETS (SVG CONFIG) */
        const svgShapes = {
            'octagon': `<svg width="80" height="80" viewBox="0 0 100 100"><polygon points="30,0 70,0 100,30 100,70 70,100 30,100 0,70 0,30" fill="#EF476F" stroke="white" stroke-width="4"/></svg>`,
            'triangle': `<svg width="80" height="80" viewBox="0 0 100 100" overflow="visible"><polygon points="50,10 95,90 5,90" fill="white" stroke="#EF476F" stroke-width="8"/></svg>`,
            'triangle-inv': `<svg width="80" height="80" viewBox="0 0 100 100" overflow="visible"><polygon points="50,90 95,10 5,10" fill="white" stroke="#EF476F" stroke-width="8"/></svg>`,
            'circle-blue': `<svg width="80" height="80" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="#4FACFE" stroke="white" stroke-width="4"/></svg>`,
            'circle-red': `<svg width="80" height="80" viewBox="0 0 100 100"><circle cx="50" cy="50" r="42" fill="white" stroke="#EF476F" stroke-width="10"/></svg>`,
            'square-blue': `<svg width="80" height="80" viewBox="0 0 100 100"><rect x="5" y="5" width="90" height="90" rx="10" fill="#4FACFE" stroke="white" stroke-width="4"/></svg>`,
            'diamond': `<svg width="80" height="80" viewBox="0 0 100 100"><rect x="15" y="15" width="70" height="70" fill="#FFD166" transform="rotate(45 50 50)" stroke="white" stroke-width="4"/></svg>`
        };

        const icons = [
            { id: 'stop', html: 'STOP', type: 'text' },
            { id: 'walk', html: '<i class="fa-solid fa-person-walking"></i>', type: 'icon' },
            { id: 'bike', html: '<i class="fa-solid fa-bicycle"></i>', type: 'icon' },
            { id: 'bus', html: '<i class="fa-solid fa-bus"></i>', type: 'icon' },
            { id: 'brick', html: '<div style="width:60px; height:15px; background:black;"></div>', type: 'div' },
            { id: 'kids', html: '<i class="fa-solid fa-children"></i>', type: 'icon' }
        ];

        /* LEVELS */
        const levels = [
            { id: 1, name: '"–¢–û“ö–¢–ê" (STOP)', shape: 'octagon', icon: 'stop', hint: '“ö—ã–∑—ã–ª —Å–µ–≥—ñ–∑–±“±—Ä—ã—à + STOP' },
            { id: 2, name: '–ñ–∞—è—É –∂“Ø—Ä–≥—ñ–Ω—à—ñ–ª–µ—Ä –∂–æ–ª—ã', shape: 'square-blue', icon: 'walk', hint: '–ö”©–∫ —à–∞—Ä—à—ã + –ê–¥–∞–º' },
            { id: 3, name: '–í–µ–ª–æ—Å–∏–ø–µ–¥ –∂–æ–ª—ã', shape: 'circle-blue', icon: 'bike', hint: '–ö”©–∫ —à–µ“£–±–µ—Ä + –í–µ–ª–æ—Å–∏–ø–µ–¥' },
            { id: 4, name: '–ñ–æ–ª –±–µ—Ä—ñ“£—ñ–∑', shape: 'triangle-inv', icon: 'none', hint: '–¢”©“£–∫–µ—Ä—ñ–ª–≥–µ–Ω “Ø—à–±“±—Ä—ã—à (–±–æ—Å)' },
            { id: 5, name: '–ë–∞–ª–∞–ª–∞—Ä', shape: 'triangle', icon: 'kids', hint: '“Æ—à–±“±—Ä—ã—à + –ë–∞–ª–∞–ª–∞—Ä' }
        ];

        let currentLvlIdx = 0;
        let builtShape = null;
        let builtIcon = null;

        /* INIT */
        function init() {
            renderShapes();
            renderIcons();
            loadLevel(0);
        }

        /* RENDERING */
        function renderShapes() {
            const list = document.getElementById('shapes-list');
            for (const [key, svg] of Object.entries(svgShapes)) {
                let div = document.createElement('div');
                div.className = 'part-item';
                div.innerHTML = svg;
                div.draggable = true;
                div.ondragstart = (e) => startDrag(e, 'shape', key);
                div.onclick = () => selectPart('shape', key); // Click support
                list.appendChild(div);
            }
        }

        function renderIcons() {
            const list = document.getElementById('icons-list');
            icons.forEach(i => {
                let div = document.createElement('div');
                div.className = 'part-item';
                div.innerHTML = i.html;

                // Styling preview for list
                if (i.type === 'text') div.style.fontWeight = '900';
                if (i.type === 'icon') div.style.fontSize = '2rem';

                div.draggable = true;
                div.ondragstart = (e) => startDrag(e, 'icon', i.id);
                div.onclick = () => selectPart('icon', i.id); // Click support
                list.appendChild(div);
            });
        }

        /* DRAG & DROP LOGIC */
        function startDrag(e, type, id) {
            e.dataTransfer.setData('type', type);
            e.dataTransfer.setData('id', id);
        }

        function allowDrop(e) { e.preventDefault(); }

        function handleEnter(e) { document.getElementById('drop-zone').classList.add('hover'); }
        function handleLeave(e) { document.getElementById('drop-zone').classList.remove('hover'); }

        function handleDrop(e) {
            e.preventDefault();
            document.getElementById('drop-zone').classList.remove('hover');
            const type = e.dataTransfer.getData('type');
            const id = e.dataTransfer.getData('id');
            selectPart(type, id);
        }

        /* LOGIC */
        function selectPart(type, id) {
            const dz = document.getElementById('drop-zone');

            if (type === 'shape') {
                builtShape = id;
                dz.innerHTML = ''; // Clear previous shape

                // Add Shape SVG (Scaled up)
                let tempDiv = document.createElement('div');
                tempDiv.innerHTML = svgShapes[id];
                let svg = tempDiv.firstChild;
                svg.setAttribute('width', '200');
                svg.setAttribute('height', '200');
                svg.classList.add('sign-base');

                // Specific styling for "Solid Red Circle" (No entry brick base)
                // Wait, I used 'circle-red' which is border only.
                // If I need 'no-entry' solid red circle...
                // Let's stick to simple logic: circle-blue is solid.
                // If "Prohibition" (e.g. No Entry), let's assume 'circle-red' border is used for simplicity in this game OR adjust.
                // Actually Level 3 is "No Entry BRICK". That is usually solid red.
                // But Level 5 is "Kids" Warning (Triangle).

                dz.appendChild(svg);

                // If icon exists, re-append
                if (builtIcon) renderIconOnSign();
            }

            if (type === 'icon') {
                builtIcon = id;
                renderIconOnSign();
            }
        }

        function renderIconOnSign() {
            if (!builtShape) return; // Need shape first
            const dz = document.getElementById('drop-zone');

            // Remove existing icon
            let existing = dz.querySelector('.sign-icon-el');
            if (existing) existing.remove();

            const iData = icons.find(x => x.id === builtIcon);
            let el = document.createElement('div');
            el.className = 'sign-icon-el';
            el.innerHTML = iData.html;

            // Style positioning
            el.style.position = 'absolute';
            el.style.zIndex = '50';
            el.style.display = 'flex';
            el.style.alignItems = 'center';
            el.style.justifyContent = 'center';

            // Auto-Color logic
            let color = '#333';
            if (builtShape === 'octagon') color = 'white'; // STOP
            if (builtShape === 'circle-blue' || builtShape === 'square-blue') color = 'white';

            // Text STOP
            if (builtIcon === 'stop') {
                el.style.color = color;
                el.style.fontSize = '3rem';
                el.style.fontWeight = '900';
                el.style.fontFamily = 'sans-serif';
            } else if (builtIcon === 'brick') {
                // The 'brick' html is a black div.
                // If shape is circle-red (border), it's weird.
                // Standard is Solid Red.
                // Let's assume circle-red is solid for this game if needed? 
                // Or just make it Red.
                let brickDiv = el.firstChild;
                brickDiv.style.background = (builtShape === 'circle-red') ? 'black' : 'black';
            } else {
                // Icons
                el.style.color = color;
                el.style.fontSize = '4rem';
            }

            // Triangle adjustments
            if (builtShape === 'triangle') el.style.marginTop = '20px';
            if (builtShape === 'triangle-inv') el.style.marginBottom = '20px';

            dz.appendChild(el);
        }

        function clearSign() {
            builtShape = null;
            builtIcon = null;
            document.getElementById('drop-zone').innerHTML = '<span style="color:#aaa; pointer-events:none;">–ë”©–ª—à–µ–∫—Ç–µ—Ä–¥—ñ –æ—Å—ã–Ω–¥–∞ —Ç–∞—Å—Ç–∞“£—ã–∑</span>';
            hideFeedback();
        }

        function checkSign() {
            if (!builtShape) {
                showFeedback(false, "–ê–ª–¥—ã–º–µ–Ω –ø—ñ—à—ñ–Ω–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑!");
                return;
            }

            const lvl = levels[currentLvlIdx];
            // Check
            let iconOk = (builtIcon === lvl.icon) || (lvl.icon === 'none' && builtIcon === null);

            if (builtShape === lvl.shape && iconOk) {
                document.getElementById('win-modal').style.display = 'flex';
            } else {
                showFeedback(false, "“ö–∞—Ç–µ! " + lvl.hint);
            }
        }

        function nextLevel() {
            document.getElementById('win-modal').style.display = 'none';
            if (currentLvlIdx < levels.length - 1) {
                loadLevel(currentLvlIdx + 1);
            } else {
                // Done
                alert("–ë–∞—Ä–ª—ã“õ –¥–µ“£–≥–µ–π –∞—è“õ—Ç–∞–ª–¥—ã! “ö“±—Ç—Ç—ã“õ—Ç–∞–π–º—ã–∑!");
                window.location.href = 'game.html';
            }
        }

        function loadLevel(idx) {
            currentLvlIdx = idx;
            const lvl = levels[idx];
            document.getElementById('lvl-count').innerText = (idx + 1) + '/' + levels.length;
            document.getElementById('lvl-name').innerText = lvl.name;
            document.getElementById('lvl-hint').innerText = lvl.hint;
            clearSign();
            hideFeedback();
        }

        function showFeedback(success, msg) {
            const fb = document.getElementById('feedback');
            fb.innerText = msg;
            fb.style.color = success ? 'green' : 'red';
            fb.classList.add('show');
        }
        function hideFeedback() {
            document.getElementById('feedback').classList.remove('show');
        }

        init();
    </script>
</body>

</html>